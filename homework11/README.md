OS work
===

Цель
---
Попрактиковаться в работе с процессами ОС Linux

Для выполнения задания нужно написать парсер системных процессов команды 'ps aux' на языке Python с использованием стандартной библиотеки и модуля subprocess.
Парсер должен вывести в стандартный вывод в качестве результата работы следующую информацию (все цифры и данные для примера):

Отчёт о состоянии системы:
Пользователи системы: 'root', 'user1', ...
Процессов запущено: 833

Пользовательских процессов:
root: 533
user1: 231
...

Всего памяти используется: 553.3 mb
Всего CPU используется: 33.2%
Больше всего памяти использует: (%имя процесса, первые 20 символов если оно длиннее)
Больше всего CPU использует: (%имя процесса, первые 20 символов если оно длиннее)

Так же этот отчёт должен быть сохранён в отдельный txt файл с названием текущей даты и времени проверки.
Например, 10-12-2021-12:15-scan.txt


How to test
---
```
(.venv) ➜  Homework git:(homework11) ✗ python homework11/app.py
Отчёт о состоянии системы:
Пользователи системы: redilonka, root
Процесcов запущено: 597

Пользовательских процессов:
redilonka: 414
root: 116

Всего памяти используется: 7389.2 mb
Всего CPU используется: 273.3%
Больше всего памяти использует: com.docker.hyperkit
Больше всего CPU использует: softwareupdated
```


Access Log parser
===

Цель
---
Написать скрипт анализа приложенного access.log файла
Требования к реализации

Должна быть возможность указать директорию где искать логи или конкретный файл

Должна быть возможность обработки всех логов внутри одной дирректории

Для access.log должна собираться следующая информация:

общее количество выполненных запросов
количество запросов по типу: GET - 20, POST - 10 и т.п.
топ 3 IP адресов, с которых были сделаны запросы
топ 3 самых долгих запросов, должно быть видно метод, url, ip, время запроса
Собранная статистика должна быть сохранена в json файл и выведена в терминал в свободном (но понятном!) формате
Должен быть README.md файл, который описывает как работает скрипт



Как работает скрипт:
---
Скрипт принимает в качестве аргументов директорию для поиска лог файлов, прямой путь к файлу, парамерт --save для сохранения результатов сканирования.
Приоритет имеет прямой путь к файлу.

Более экономично было бы открывать файлы напрямую питоном, ноо в целях тренировки был выбран способ совмещения выполнения команды `cat` с последующим парсингов результата.

Анализ результата парсинга происходит следующим образом:
- self._collect_total_request_count() -> смотрим количество запросов
- self._collect_method_stats() -> собираем статистику методов встроенным классом Counter
- self._collect_ip_stats() -> собираем статистику для IP адрессов
- self._collect_long_requests() -> собираем статистику для длятельности запросов (%D - микросекунды, потому далее делим на 1000000 для получания секунд)
- генерируем вывод
- опционально сохраняем JSON

Что можно улучщить:
- открывать через open("access.log") -> этим уменьшим расход памяти
- создавать несколько потоков, для парсинга файлов частями -> этим ускорим обработку
- добавить обработку несуществующих директорий и файлов


Пример использования
---
```
➜  Homework git:(redilonka/fea/access_parser) ✗ python homework11/log_parser.py -d .. --save
Following command is about to start: cat ../access2.log
Общее количество выполненных запросов: 9

Количество запросов по типу: GET: 5, POST: 4

Топ 3 IP адресов, с которых были сделаны запросы:
IP: 109.169.248.247: 2 запросов
IP: 46.72.177.4: 2 запросов
IP: 83.167.113.100: 2 запросов

Топ 3 самых долгих запросов:
URL: /administrator/index.php IP: 95.29.198.15 Time: 0.009865 сек
URL: /administrator/index.php IP: 83.167.113.100 Time: 0.008566 сек
URL: /administrator/ IP: 109.184.11.34 Time: 0.00789 сек

Сломанных записей: 1

Сохранен json файл homework11/11-18-2021-00:02:35-access-log-analysis.json

Following command is about to start: cat ../access.log
Общее количество выполненных запросов: 3216571

Количество запросов по типу: GET: 2247696, POST: 918794, HEAD: 49971, PUT: 70, OPTIONS: 39, DELETE: 1

Топ 3 IP адресов, с которых были сделаны запросы:
IP: 193.106.31.130: 235209 запросов
IP: 198.50.156.189: 167812 запросов
IP: 5.112.235.245: 166722 запросов

Топ 3 самых долгих запросов:
URL: /administrator/index.php IP: 62.93.172.245 Time: 0.01 сек
URL: /media/system/css/modal.css IP: 213.162.68.113 Time: 0.01 сек
URL: /images/phocagallery/almhuette/thumbs/phoca_thumb_m_terasse.jpg IP: 194.166.55.43 Time: 0.01 сек

Сломанных записей: 410

Сохранен json файл homework11/11-18-2021-00:04:06-access-log-analysis.json
```

Пример сломанных записей:

```
73.193.87.142 - - [23/Apr/2019:19:11:32 +0200] "PROPFIND /apache-log/ HTTP/1.1" 404 217 "-" "Microsoft-WebDAV-MiniRedir/10.0.17134" 1370
91.218.225.68 - username [20/Jun/2018:09:18:48 +0200] "GET /private/ HTTP/1.1" 401 409 "-" "Mozilla/5.00 (Nikto/2.1.6) (Evasions:None) (Test:001805)" 5449
91.218.225.68 - "" [20/Jun/2018:09:18:40 +0200] "GET /private/ HTTP/1.1" 401 409 "-" "Mozilla/5.00 (Nikto/2.1.6) (Evasions:None) (Test:001805)" 9718
91.218.225.68 - - [20/Jun/2018:09:17:24 +0200] "get / HTTP/1.1" 200 10439 "-" "Mozilla/5.00 (Nikto/2.1.6) (Evasions:None) (Test:000445)" 9021
192.185.81.59 - - [03/Oct/2017:07:43:14 +0200] "Head //images/stories/movie.php HTTP/1.1" 501 302 "-" "BOT/0.1 (BOT for JCE)" 4845
5201
```

Среди приведенных выше записей встречаются и записи вида '"GET ', которые не являются корректными из-за предшествующей части лог-записи вида `91.218.225.68 - "" [20/Jun/2018:09:18:40 +0200]` или `91.218.225.68 - username [20/Jun/2018:09:18:48 +0200]` и не учитываются при подсчете.

Данные записи отсекаются регулярным выражением:

```
r'^(?P<ip>\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}) - - \[(?P<time>.+)\] "(?P<details>(GET|POST|PUT|DELETE|HEAD|OPTIONS) .*)" (?P<status>.+) (?P<length>.+) "(?P<refferer>.*)" ".*" (?P<request_time>.+)'
```
